---
layout:     post
title:      Mongodb
subtitle:   安装与使用
date:       2019-10-31
author:     JackyCJ
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - Python
    - mongodb

---

<div id="header"></div>
# 一、Mac下安装

```
brew install mongodb
```

检查安装是否成功

```
mongod -version
```
浏览器访问: localhost:27017

### 配置数据库
MongoDB默认数据库目录

|系统|默认目录|
|:-----:|:-----:|
|Windows|c:\data|
|Mac|/data/db|

首先创建保存数据的文件夹：

```
sudo mkdir -p /data/db
```
给刚创建的文件夹写入数据权限：

```
sudo chown -R $USER /data/db
```
R是recursive递归的意思,也可以通过finder手动创建文件夹/data/db。

如果不想把数据放在默认目录，可以自行指定:

```
# command
mongod -dbpath /path
# config
mongod -config /mongo.cfg
```

### 启动mongod服务
mongod服务也就是mongodb数据库，启动mongod服务端只需要一个很简单的命令：

```
mongod
```



# 二、可视化工具
### [下载Robomongo](https://robomongo.org/download)

![](https://tva1.sinaimg.cn/large/006y8mN6gy1g8hjfzn4q7j31jq0u07bw.jpg)


# 三、通过Python调用

```
import pymongo

mycl = pymongo.MongoClient('localhost', 27017)
print(mycl.database_names())
# py3.7以后使用list_database_names()
mydb = mycl.test_database
print(mydb.collection_names())

# 创建
mydb = mycl['dbname']
# 集合
mycol = mydb['colname']
```

<div id="insert"></div>
## 1.添加
#### 1.1.插入一条
```
mydict = {"name": "test", "url": "https://jackycj.github.io"}
mycol.insert_one(mydict)
```
#### 1.2.插入多条
```
mydicts = [
	{"name": "test", "url": "https://jackycj.github.io"},
	{"name": "test", "url": "https://jackycj.github.io"}
]
mycol.insert_many(mydicts)
```

<div id="select"></div>
## 2.查询
#### 2.1.查询单条
```
x = mycol.find_one()
print(x)
```
#### 2.2.查询全部
```
for x in mycol.find():
	print(x)
```
#### 2.3.查询指定字段
我们可以使用 __find()__ 方法来查询指定字段的数据，将要返回的字段对应值设置为 1。除了 ___id__ 你不能在一个对象中同时指定 0 和 1，如果你设置了一个字段为 0，则其他都为 1，反之亦然。

```
for x in mycol.find({},{ "_id": 0, "name": 1}):
	print(x)
```
#### 2.4.返回指定条数记录
如果我们要对查询结果设置指定条数的记录可以使用 __limit()__ 方法，该方法只接受一个数字参数。

```
ret = mycol.find().limit(3)
```

<div id="sort"></div>
## 3.排序
__sort()__ 方法可以指定升序或降序排序。

```
# 默认升序
ret = mycol.find().sort('name')
```
__sort()__ 方法第一个参数为要排序的字段，第二个字段指定排序规则，1 为升序，-1 为降序，默认为升序。

```
# 降序
ret = mycol.find().sort('name', -1)
```

<div id="modify"></div>
## 4.修改
#### 4.1.修改一个记录
我们可以在MongoDB中使用 __update_one()__ 方法修改文档中的记录。该方法第一个参数为查询的条件，第二个参数为要修改的字段。
如果查找到的匹配数据多余一条，则只会修改第一条。

```
myquery = { "name": "test" }
newvalues = { "$set": { "name": "12345" } }
mycol.update_one(myquery, newvalues)
```
#### 4.2.修改多个记录
通过 __update_one()__ 方法只能修匹配到的第一条记录，如果要修改所有匹配到的记录，可以使用 __update_many()__ 。

以下实例将查找所有以t开头的 __name__ 字段，并将匹配到所有记录的 __name__ 字段修改为123：

```
myquery = { "name": { "$regex": "^t" } }
newvalues = { "$set": { "name": "123" } }
x = mycol.update_many(myquery, newvalues)
print(x.modified_count, "文档已修改")
```

<div id="del"></div>
## 5.删除
#### 5.1.删除一个文档
我们可以使用 __delete_one()__ 方法来删除一个文档，该方法第一个参数为查询对象，指定要删除哪些数据。

```
myquery = { "name": "test" }
mycol.delete_one(myquery)
```
#### 5.2.删除多个文档
我们可以使用 __delete_many()__ 方法来删除多个文档，该方法第一个参数为查询对象，指定要删除哪些数据。

删除所有 __name__ 字段中以 __t__ 开头的文档:

```
myquery = { "name": {"$regex": "^t"} }
x = mycol.delete_many(myquery)
print(x.deleted_count, "个文档已删除")
```
#### 5.3.删除集合中的所有文档
__delete_many()__ 方法如果传入的是一个空的查询对象，则会删除集合中的所有文档：

```
x = mycol.delete_many({})
print(x.deleted_count, "个文档已删除")
```

#### 5.4.删除集合
我们可以使用 drop() 方法来删除一个集合。如果删除成功返回 true，如果删除失败(集合不存在)则返回 false。

```
mycol.drop()
```

## 6.汇总
对MongoDB操作语法进行汇总如下

| 功能 | 语法 | 备注 |
|:--------:|:---------:|:-------:|
| [添加数据](#insert) | __insert\_one() insert_many()__ | |
| [查询数据](#select) | __find\_one() find_many()__ | |
| [数据排序](#sort) | __sort()__ | |
| [修改数据](#modify) | __update\_one() update\_many()__ | |
| [删除数据](#del) | __delete_one() delete\_many() drop()__ | |


# 参考文档
+ [mac使用Homebrew安装MongoDB](https://www.jianshu.com/p/d929436a4b7c)
+ [Python MongoDB](https://www.runoob.com/python3/python-mongodb.html)
